{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/*\r\n * Custom\r\n */\r\nfunction addTextNode(text) {\r\n  let newtext = document.createTextNode(text);\r\n  return newtext;\r\n}\r\n\r\nfunction setAttr(item, htmlElement){\r\n\tfor (key in item){\r\n\t\tif (key != \"text\" && key != \"tag\" && key != \"html\" && key != \"text\" && key != \"children\") {\r\n\t\t\thtmlElement.setAttribute(key, item[key]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction renderHTML(element, parent){\r\n\t//if it is the deepest tag element\r\n\tif (!Array.isArray(element) && !element.children) {\r\n\t\tif (element.text) {\r\n\t\t\treturn parent.append(addTextNode(element.text));\r\n\t\t} else {\r\n\t\t\tlet htmlElem = document.createElement(element.tag);\r\n\t\t\t//add attributes\r\n\t\t\tsetAttr(element,htmlElem);\r\n\r\n\t\t\thtmlElem.append(addTextNode(element.html));\r\n\t\t\treturn parent.appendChild(htmlElem);\r\n\t\t}\r\n\t} else {\r\n\t\telement.forEach((item)=> {\r\n\t\t\tif (item.children) {\r\n\t\t\t\tlet htmlElem = document.createElement(item.tag);\r\n\t\t\t\t//add attributes\r\n\t\t\t\tsetAttr(item, htmlElem);\r\n\r\n\t\t\t\tparent.appendChild(htmlElem);\r\n\t\t\t\trenderHTML(item.children, htmlElem);\r\n\t\t\t} else {\r\n\t\t\t\trenderHTML(item, parent);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n//return json parsed json file\r\nconst  getJSON = async (path)=> {\r\n\tlet response = await fetch(path);\r\n\tlet data = await response.json();\r\n\treturn data;\r\n}\r\n'use strict';\r\n\r\nclass Storage {\r\n\tconstructor(){\r\n\t\tthis.tempItems = [];\r\n\t\tthis.tempUsers = [];\r\n\t\tthis.tempBoughtItems = [];\r\n\t\tthis.filterParams = {};\r\n\t\tthis.path = {\r\n\t\t\titems: 'json/listitems.json',\r\n\t\t\tusers: 'json/users.json'\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.loadLocalStorage();\r\n\t}\r\n\r\n\tasync loadLocalStorage() {\r\n\t\tlet items = localStorage.getItem('items');\r\n\t\tlet users = localStorage.getItem('users');\r\n\t\tawait this.updateTempStorage(items, 'items');\r\n\t\tawait this.updateTempStorage(users, 'users');\r\n\t}\r\n\r\n\tasync updateTempStorage(data, key) {\r\n\t\tswitch (key) {\r\n\t\t\tcase 'items':\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tthis.tempItems = JSON.parse(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.tempItems = await getJSON(this.path.items);\r\n\t\t\t\t\tthis.saveToLocalStorage(key, this.tempItems);\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tcase 'users':\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tthis.tempUsers = JSON.parse(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.tempUsers = await getJSON(this.path.users);\r\n\t\t\t\t\tthis.saveToLocalStorage(key, this.tempUsers);\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tdefault: throw Error ('serever not respond');\r\n\t\t}\r\n\t}\r\n\r\n\tupdateAllLocalStorage(){\r\n\t\tthis.saveToLocalStorage('users', this.tempUsers);\r\n\t\tthis.saveToLocalStorage('items', this.tempItems);\r\n\t}\r\n\r\n\r\n\tsaveToLocalStorage(key, data) {\r\n\t\tlocalStorage.setItem(key, JSON.stringify(data));\r\n\t}\r\n\r\n\tcomparePriceToHigh(itemA, itemB){\r\n\t\treturn itemB.price - itemA.price;\r\n\t}\r\n\r\n\tcomparePriceToLow(itemA, itemB){\r\n\t\treturn itemA.price - itemB.price;\r\n\t}\r\n\r\n\t getTempStorage(name) {\r\n\t\tswitch (name) {\r\n\t\t\tcase 'items':\r\n\t\t\t\treturn this.tempItems.sort(this.comparePriceToHigh);\r\n\t\t\tcase 'users':\r\n\t\t\t\treturn this.tempUsers;\r\n\t\t\tdefault: throw Error ('serever not respond');\r\n\t\t}\r\n\t}\r\n\r\n\tgetItemById(id) {\r\n\t\treturn this.tempItems.find(item => item.id_item == id);\r\n\t}\r\n\r\n\tgetFilteredItems(params){\r\n\t\tthis.filterParams = params;\r\n\t\tconsole.dir(this.filterParams);\r\n\t\tlet filterArrItems = this.getItemsByAvailable();\r\n\t\tfilterArrItems = this.getItemsByCondition(filterArrItems);\r\n\t\tfilterArrItems = this.getItemsByShipping(filterArrItems);\r\n\t\tfilterArrItems = this.getItemsByFormat(filterArrItems);\r\n\t\tfilterArrItems = this.getItemsByPrice(filterArrItems);\r\n\t\tfilterArrItems = this.getItemsByUserRequest(filterArrItems);\r\n\t\tfilterArrItems - this.sortByDirection(filterArrItems)\r\n\t\treturn filterArrItems;\r\n\t}\r\n\r\n\tmakeArray(str) {\r\n\t\treturn str.split(',');\r\n\t}\r\n\r\n\tgetItemsByAvailable() {\r\n\t\treturn this.tempItems.filter(item => item.reserved == false);\r\n\t}\r\n\r\n\tsortByDirection(arr) {\r\n\t\tif (this.filterParams['sort']){\r\n\t\t\tswitch (this.filterParams['sort']){\r\n\t\t\t\tcase 'lowprice':\r\n\t\t\t\t\treturn arr.sort(this.comparePriceToHigh);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 'highprice':\r\n\t\t\t\t\treturn arr.sort(this.comparePriceToLow);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault: arr.sort(this.comparePriceToHigh);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr.sort(this.comparePriceToHigh);\r\n\t}\r\n\r\n\tgetItemsByUserRequest(arr){\r\n\t\tif (this.filterParams['userrequest']){\r\n\t\t\tlet strParams = this.makeArray(this.filterParams['userrequest']).join(' ');\r\n\t\t\treturn arr.filter(item => new RegExp(strParams, 'i').test(item.title));\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tgetItemsByPrice(arr){\r\n\t\tif(this.filterParams['from']) {\r\n\t\t\tif (this.filterParams['to']) {\r\n\t\t\t\treturn arr.filter(item => {\r\n\t\t\t\t\treturn parseInt(item.price) >= +this.filterParams['from'] && parseInt(item.price) <= +this.filterParams['to'];\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\treturn arr.filter(item => {\r\n\t\t\t\t\treturn parseInt(item.price) >= +this.filterParams['from'];\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tgetItemsByCondition(arr){\r\n\t\tif (this.filterParams['condition']){\r\n\t\t\tlet arrParams = this.makeArray(this.filterParams['condition']);\r\n\t\t\tif (arrParams.length == 2) {\r\n\t\t\t\treturn arr.filter(item => {return item.condition == arrParams[0] || item.condition == arrParams[1]})\r\n\t\t\t}\r\n\t\t\tif (arrParams.length == 1) {\r\n\t\t\t\treturn arr.filter(item => item.condition == arrParams[0]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\treplaceShippingParams(arr){\r\n\t\treturn arr.map(name =>{\r\n\t\t\tif (name == 'free') {\r\n\t\t\t\treturn 'Free Shipping';\r\n\t\t\t}\r\n\t\t\tif (name == 'instore') {\r\n\t\t\t\treturn 'Free In-store Pickup';\r\n\t\t\t}\r\n\t\t\tif (name == 'local') {\r\n\t\t\t\treturn 'Free Local Pickup';\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tgetItemsByShipping(arr){\r\n\t\tif (this.filterParams['shipping']){\r\n\t\t\tlet arrParams = this.makeArray(this.filterParams['shipping']);\r\n\t\t\tarrParams = this.replaceShippingParams(arrParams);\r\n\t\t\tconsole.log(arrParams);\r\n\t\t\t\tif (arrParams.length == 3) {\r\n\t\t\t\t\treturn arr.filter(item => {return item.shipping == arrParams[0] || item.shipping == arrParams[1] || item.shipping == arrParams[2]});\r\n\t\t\t\t}\r\n\t\t\t\tif (arrParams.length == 2) {\r\n\t\t\t\t\treturn arr.filter(item => {return item.shipping == arrParams[0] || item.shipping == arrParams[1]});\r\n\t\t\t\t}\r\n\t\t\t\tif (arrParams.length == 1) {\r\n\t\t\t\t\treturn arr.filter(item => item.shipping == arrParams[0]);\r\n\t\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tgetItemsByFormat(arr){\r\n\t\tswitch (this.filterParams['format']){\r\n\t\t\tcase 'buyitnow':\r\n\t\t\t\treturn arr.filter(item => item.buy == true);\r\n\t\t\tbreak;\r\n\t\t\tcase 'auction':\r\n\t\t\t\treturn arr.filter(item => item.auction == true)\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('default'); return arr;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//add user who is logined to LocalStorage\r\n\taddLoginedUsertoLocalStorage(user){\r\n\t\tlocalStorage.setItem('activeUser', JSON.stringify(user));\r\n\t}\r\n\r\n\tremoveLoginedUserFromLocalStorage(){\r\n\t\tlocalStorage.removeItem('activeUser');\r\n\t}\r\n\r\n\tgetLoginedUserFromTempStorage(){\r\n\t\tlet loginedUser = JSON.parse(localStorage.getItem('activeUser'));\r\n\t\tif (loginedUser){\r\n\t\t\treturn this.tempUsers.find(user => user.login === loginedUser.login);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\taddNewItemToTempStorage(data){\r\n\t\tthis.tempItems.push(data);\r\n\t\tconsole.dir(this.tempItems);\r\n\t\tthis.saveToLocalStorage('items', this.tempItems);\r\n\t}\r\n\taddNewUsertoTempStorage(data){\r\n\t\tthis.tempUsers.push(data);\r\n\t\tconsole.dir(this.tempUsers);\r\n\t\tthis.saveToLocalStorage('users', this.tempUsers);\r\n\t}\r\n\r\n\tgetBoughtItemsByUser(){\r\n\t\tlet loginedUser = this.getLoginedUserFromTempStorage();\r\n\t\tfor (let i = 0; i< loginedUser.buyitems.length; i++){\r\n\t\t\tconsole.log(loginedUser.buyitems[i]);\r\n\t\t\tthis.tempBoughtItems.push(this.getItemById(loginedUser.buyitems[i].item))\r\n\t\t}\r\n\t\tconsole.dir(this.tempBoughtItems);\r\n\t\treturn this.tempBoughtItems;\r\n\t}\r\n\tgenerateNewId(){\r\n\t\tconsole.dir(this.tempItems[9]);\r\n\t\treturn +this.tempItems[this.tempItems.length-1]['id_item'] + 1 + '';\r\n\t}\r\n}\r\n// option all or empty\r\nclass Filter {\r\n\tconstructor({option = 'search', params = {}} ={}){\r\n\t\tthis.regExp = /^\\/search.+/i;\r\n\t\tthis.userrequestRegExp = /[a-z0-9a-zа-яё]+/gi;\r\n\t\tthis.option = option;\r\n\t\tthis.params = params;\r\n\t\tthis.init();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.findNodes();\r\n\t\tthis.bindAll();\r\n\t\tthis.addEvents();\r\n\t\tthis.autoCheck();\r\n\t}\r\n\r\n\tfindNodes() {\r\n\t\tif (this.option == 'all') {\r\n\t\t\tthis.nodes = {\r\n\t\t\t\tcondition: document.getElementsByName('condition'),\r\n\t\t\t\tshipping: document.getElementsByName('shipping'),\r\n\t\t\t\tfrom: document.getElementById('from'),\r\n\t\t\t\tto: document.getElementById('to'),\r\n\t\t\t\tbtnfromto: document.getElementById('btnfromto'),\r\n\t\t\t\tsearch: document.getElementById('search'),\r\n\t\t\t\tsearchBtn: document.getElementById('search-input'),\r\n\t\t\t\tbuyitnow: document.getElementById('buyitnow'),\r\n\t\t\t\tauction: document.getElementById('auction'),\r\n\t\t\t\tformat: document.getElementsByName('format'),\r\n\t\t\t\tsort: document.getElementById('sort'),\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.nodes = {\r\n\t\t\t\tsearch: document.getElementById('search'),\r\n\t\t\t\tsearchBtn: document.getElementById('search-input'),\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tbindAll() {\r\n\t\tthis.checkCondition = this.checkCondition.bind(this);\r\n\t\tthis.checkShipping = this.checkShipping.bind(this);\r\n\t\tthis.rangePrice = this.rangePrice.bind(this);\r\n\t\tthis.checkFormat = this.checkFormat.bind(this);\r\n\t\tthis.search = this.search.bind(this);\r\n\t\tthis.sort = this.sort.bind(this);\r\n\t\tthis.handler = this.handler.bind(this);\r\n\t\tthis.handlerAll = this.handlerAll.bind(this);\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tif (this.option == 'all'){\r\n\t\t\tthis.nodes.condition[0].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.condition[1].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.shipping[0].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.shipping[1].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.shipping[2].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.btnfromto.addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.format[0].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.format[1].addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.searchBtn.addEventListener('click', this.handlerAll);\r\n\t\t\tthis.nodes.sort.addEventListener('change', this.handlerAll);\r\n\t\t} else {\r\n\t\t\tthis.nodes.searchBtn.addEventListener('click', this.handler);\r\n\t\t}\r\n\t}\r\n\r\n\tmakeArray(str) {\r\n\t\treturn str.split(',');\r\n\t}\r\n\r\n\t// check filter and sort options after location.assign\r\n\tautoCheck() {\r\n\t\tif (this.params['condition']){\r\n\t\t\tlet arrParams = this.makeArray(this.params['condition']);\r\n\t\t\tthis.autoCheckCondition(arrParams);\r\n\t\t}\r\n\t\tif (this.params['shipping']){\r\n\t\t\tlet arrParams = this.makeArray(this.params['shipping']);\r\n\t\t\tthis.autoCheckShipping(arrParams);\r\n\t\t}\r\n\r\n\t\tif (this.params['to']){\r\n\t\t\tlet arrParams = this.makeArray(this.params['to']);\r\n\t\t\tthis.autoCheckRangePrice(arrParams, 'to');\r\n\t\t}\r\n\t\tif (this.params['from']){\r\n\t\t\tlet arrParams = this.makeArray(this.params['from']);\r\n\t\t\tthis.autoCheckRangePrice(arrParams, 'from');\r\n\t\t}\r\n\t\tif (this.params['format']){\r\n\t\t\tthis.autoCheckFormat(this.params['format']);\r\n\t\t}\r\n\t\tif (this.params['userrequest']){\r\n\t\t\tlet arrParams = this.makeArray(this.params['userrequest']);\r\n\t\t\tthis.autoFillSearch(arrParams);\r\n\t\t}\r\n\t\tif (this.params['sort']){\r\n\t\t\tthis.autoCheckSort(this.params['sort']);\r\n\t\t}\r\n\t}\r\n\r\n\tautoCheckSort(value){\r\n\t\tswitch (value) {\r\n\t\t\tcase 'lowprice':\r\n\t\t\t\tthis.nodes.sort.getElementsByTagName('option')[0].selected = true;\r\n\t\t\tbreak;\r\n\t\t\tcase 'highprice':\r\n\t\t\t\tthis.nodes.sort.getElementsByTagName('option')[1].selected = true;\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('invalid');\r\n\t\t}\r\n\t}\r\n\r\n\tautoFillSearch(arr) {\r\n\t\tthis.nodes.search.value = arr.join(' ');\r\n\t}\r\n\r\n\tautoCheckFormat(value){\r\n\t\tswitch (value) {\r\n\t\t\tcase 'buyitnow':\r\n\t\t\t\tthis.nodes.format[0].checked = true;\r\n\t\t\tbreak;\r\n\t\t\tcase 'auction':\r\n\t\t\t\tthis.nodes.format[1].checked = true;\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('invalid query string');\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tautoCheckRangePrice(arr, input){\r\n\t\tswitch (input) {\r\n\t\t\tcase 'to':\r\n\t\t\t\tthis.nodes.to.value = arr.toString();\r\n\t\t\tbreak;\r\n\t\t\tcase 'from':\r\n\t\t\t\tthis.nodes.from.value = arr.toString();\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('invalid query string');\r\n\t\t}\r\n\r\n\t}\r\n\tautoCheckShipping(arr) {\r\n\t\tarr.forEach(element => {\r\n\t\t\tswitch (element) {\r\n\t\t\t\tcase 'free':\r\n\t\t\t\t\tthis.nodes.shipping[0].checked = true;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 'instore':\r\n\t\t\t\t\tthis.nodes.shipping[1].checked = true;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 'local':\r\n\t\t\t\t\tthis.nodes.shipping[2].checked = true;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault: console.log('invalid query string');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tautoCheckCondition(arr) {\r\n\t\tarr.forEach(element => {\r\n\t\t\tswitch (element) {\r\n\t\t\t\tcase 'new':\r\n\t\t\t\t\tthis.nodes.condition[0].checked = true;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 'used':\r\n\t\t\t\t\tthis.nodes.condition[1].checked = true;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault: console.log('invalid query string');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetPath() {\r\n\t\tthis.currentPathName = window.location.pathname;\r\n\t}\r\n\r\n\tsearch(e) {\r\n\t\tif (this.nodes.search.value) {\r\n\t\t\tthis.params['userrequest'] = this.nodes.search.value.match(this.userrequestRegExp);\r\n\t\t} else {\r\n\t\t\tdelete this.params['userrequest'];\r\n\t\t}\r\n\t}\r\n\r\n\tsort(e) {\r\n\t\tlet indexSelected = this.nodes.sort.selectedIndex;\r\n\t\tconsole.log(indexSelected);\r\n\t\tthis.params[this.nodes.sort.getAttribute('name')] = this.nodes.sort.getElementsByTagName('option')[indexSelected].value;\r\n\t\tconsole.dir(this.params);\r\n\t}\r\n\r\n\tcheckFormat(e) {\r\n\t\tfor (let i = 0; i < this.nodes.format.length; i++) {\r\n\t\t\tif (this.nodes.format[i].checked) {\r\n\t\t\t\tthis.params[this.nodes.format[i].getAttribute('name')] = this.nodes.format[i].value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trangePrice(e) {\r\n\t\tlet from = this.nodes.from.value || 0;\r\n\t\tlet to = this.nodes.to.value || Infinity;\r\n\t\tthis.params['from'] = from;\r\n\t\tif (isFinite(to)) {\r\n\t\t\tthis.params['to'] = to;\r\n\t\t}\r\n\t}\r\n\r\n\tcheckCondition(e) {\r\n\t\tlet queryString = '';\r\n\t\tfor (let i = 0; i < this.nodes.condition.length; i++) {\r\n\t\t\tif (this.nodes.condition[i].checked) {\r\n\t\t\t\tqueryString += this.nodes.condition[i].value + ',';\r\n\t\t\t}\r\n\t\t}\r\n\t\tqueryString = queryString.slice(0, -1);\r\n\t\tif (queryString) {\r\n\t\t\tthis.params[this.nodes.condition[0].getAttribute('name')] = queryString;\r\n\t\t} else {\r\n\t\t\tdelete this.params[this.nodes.condition[0].getAttribute('name')];\r\n\t\t}\r\n\t}\r\n\r\n\tcheckShipping(e) {\r\n\t\tlet queryString = '';\r\n\t\tfor (let i = 0; i < this.nodes.shipping.length; i++) {\r\n\t\t\tif (this.nodes.shipping[i].checked) {\r\n\t\t\t\tqueryString += this.nodes.shipping[i].value + ',';\r\n\t\t\t}\r\n\t\t}\r\n\t\tqueryString = queryString.slice(0, -1);\r\n\t\tif (queryString) {\r\n\t\t\tthis.params[this.nodes.shipping[0].getAttribute('name')] = queryString;\r\n\t\t} else {\r\n\t\t\tdelete this.params[this.nodes.shipping[0].getAttribute('name')];\r\n\t\t}\r\n\t}\r\n\r\n\thandlerAll(e) {\r\n\t\tthis.checkFormat();\r\n\t\tthis.checkCondition();\r\n\t\tthis.checkShipping();\r\n\t\tthis.rangePrice();\r\n\t\tthis.search();\r\n\t\tthis.sort();\r\n\t\tthis.createURL();\r\n\t}\r\n\r\n\thandler(e) {\r\n\t\tthis.search();\r\n\t\tthis.createURL();\r\n\t}\r\n\r\n\tcreateURL(){\r\n\t\tlet url = '/search?';\r\n\t\tfor (key in this.params) {\r\n\t\t\tif (key == 'userrequest') {\r\n\t\t\t\tlet requesturl = this.params[key].reduce((sum, current) => {\r\n\t\t\t\t\treturn sum + current + ',';\r\n\t\t\t\t}, 'userrequest=');\r\n\t\t\t\turl += requesturl.slice(0, -1) + '&';\r\n\t\t\t} else {\r\n\t\t\t\turl += key + '=' + this.params[key] + '&';\r\n\t\t\t}\r\n\t\t}\r\n\t\t// url = encodeURI(url.slice(0, -1));\r\n\t\turl = url.slice(0, -1);\r\n\t\tconsole.log(url);\r\n\t\tlocation.assign(url);\r\n\t}\r\n}\r\nclass Manager {\r\n\tconstructor(){\r\n\t\tthis.storage = new Storage();\r\n\t\tthis.regExpId = /^\\/item\\d+$/i;\r\n\t\tthis.regSearch = /^\\/search$/i;\r\n\t\tthis.params = {};\r\n\t\tthis.init();\r\n\t\tconsole.log('manager init');\r\n\t}\r\n\tasync init() {\r\n\t\tawait this.storage.init();\r\n\t\tthis.getLoginedUser();\r\n\t\tthis.getPath();\r\n\t\tthis.getSearchParams()\r\n\t\tthis.onloadPage();\r\n\t}\r\n\r\n\tgetLoginedUser() {\r\n\t\tthis.loginedUser = this.storage.getLoginedUserFromTempStorage();\r\n\t}\r\n\r\n\tasync renderContactsPage() {\r\n\t\tlet response = await fetch('json/page-contacts.json');\r\n\t\tlet data = await response.json();\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\tasync renderRegistration() {\r\n\t\tlet response = await fetch('json/page-registration.json');\r\n\t\tlet data = await response.json();\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\tasync renderHeader() {\r\n\t\tif (this.loginedUser){\r\n\t\t\tlet response = await fetch('json/page-nav-left-auth.json');\r\n\t\t\tlet data = await response.json();\r\n\t\t\trenderHTML(data, document.getElementsByClassName('nav__left')[0]);\r\n\t\t\tdocument.getElementsByClassName('nav__user-name')[0].append(document.createTextNode(this.loginedUser.name));\r\n\t\t} else {\r\n\t\t\tlet response = await fetch('json/page-nav-left-unauth.json');\r\n\t\t\tlet data = await response.json();\r\n\t\t\trenderHTML(data, document.getElementsByClassName('nav__left')[0]);\r\n\t\t}\r\n\t}\r\n\r\n\tasync renderAdvert() {\r\n\t\tlet response = await fetch('json/page-text.json');\r\n\t\tlet data = await response.json();\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\trenderResult(arr) {\r\n\t\tlet templateContent = document.getElementById(\"item\");\r\n\t\tlet template = _.template(templateContent.innerHTML);\r\n\t\tlet result = arr.reduce(function(sum, current) {\r\n\t\t\treturn  template(current) + sum;\r\n\t\t}.bind(this),\"\");\r\n\t\tdocument.getElementsByClassName(\"result__container\")[0].innerHTML = result;\r\n\t}\r\n\r\n\trenderItemPage(obj) {\r\n\t\tlet templatePageItem = document.getElementById(\"item-page\");\r\n\t\tlet templateItem = _.template(templatePageItem.innerHTML);\r\n\t\tlet result = templateItem(obj);\r\n\t\tdocument.getElementsByClassName(\"main__container\")[0].innerHTML = result;\r\n\t\t//gallery\r\n\t\tvar templatePageGallery = document.getElementById('gallery-item');\r\n\t\tvar templateGallary = _.template(templatePageGallery.innerHTML);\r\n\t\tvar resultUL = obj.pictures.reduce((sum, current) => {\r\n\t\t\treturn templateGallary(current) + sum;\r\n\t\t},\"\" )\r\n\t\tdocument.getElementsByClassName('item-page__list-images')[0].innerHTML = resultUL;\r\n\t}\r\n\r\n\trenderHistory(arr){\r\n\t\tlet templateContent = document.getElementById(\"item\");\r\n\t\tlet template = _.template(templateContent.innerHTML);\r\n\t\tlet result = arr.reduce(function(sum, current) {\r\n\t\t\treturn  template(current) + sum;\r\n\t\t}.bind(this),\"\");\r\n\t\tdocument.getElementsByClassName(\"main__container\")[0].innerHTML = result;\r\n\t}\r\n\r\n\tasync renderMainPage() {\r\n\t\tlet data = await getJSON('json/page-aside-result.json');\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\tasync renderSignin() {\r\n\t\tlet response = await fetch('json/page-signin.json');\r\n\t\tlet data = await response.json();\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\tasync renderSell() {\r\n\t\tlet response = await fetch('json/page-sell.json');\r\n\t\tlet data = await response.json();\r\n\t\trenderHTML(data, document.getElementsByClassName('main__container')[0]);\r\n\t}\r\n\r\n\tgetPath() {\r\n\t\tthis.currentPathName = window.location.pathname;\r\n\t}\r\n\r\n\tgetSearchParams() {\r\n\t\tthis.searchParams = window.location.search;\r\n\t}\r\n\r\n\tgetItemIdfromPath() {\r\n\t\tlet reg = /^\\/item(\\d+$)/i;\r\n\t\treturn this.currentPathName.match(reg)[1];\r\n\t}\r\n\r\n\tparseSearchParams() {\r\n\t\t//let str =\t'/search?condition=new,used&shipping=free,instore,local&from=4&format=buyitnow&userrequest=mama+papa';\r\n\t\tlet str = this.searchParams;\r\n\t\tif (str){\r\n\t\t\tlet paramsString = str.slice(1);\r\n\t\t\tlet elements = paramsString.split('&');\r\n\t\t\tif (elements.length){\r\n\t\t\t\telements.forEach(element => {\r\n\t\t\t\t\tvar keyValue = element.split('=');\r\n\t\t\t\t\tthis.params[keyValue[0]] = keyValue[1];\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t//console.dir(this.params);\r\n\t\t}\r\n\t}\r\n\r\n\tasync onloadPage() {\r\n\t\tthis.parseSearchParams();\r\n\t\tawait this.renderHeader();\r\n\t\t//render item by id\r\n\t\tif (this.currentPathName.match(this.regExpId)){\r\n\t\t\tthis.renderItemPage(this.storage.getItemById(this.getItemIdfromPath()));\r\n\t\t\tthis.item = new Item(this.storage.getItemById(this.getItemIdfromPath()));\r\n\t\t\treturn;\r\n\t\t} //render by user filter and request\r\n\t\tif (this.currentPathName.match(this.regSearch)){\r\n\t\t\tconsole.log('render by params');\r\n\t\t\tawait this.renderMainPage();\r\n\t\t\tthis.renderResult(this.storage.getFilteredItems(this.params));\r\n\t\t\tthis.filter = new Filter({option: 'all', params: this.params})\r\n\t\t} else {\r\n\t\t\tswitch (this.currentPathName) {\r\n\t\t\t\tcase '/register':\r\n\t\t\t\t\tawait this.renderRegistration();\r\n\t\t\t\t\tthis.registration = new Registration(this.storage.getTempStorage('users'));\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/sign':\r\n\t\t\t\t\tawait this.renderSignin();\r\n\t\t\t\t\tthis.signin = new Signin(this.storage.getTempStorage('users'));\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/contacts':\r\n\t\t\t\tthis.renderContactsPage();\r\n\t\t\t\tthis.filter = new Filter();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/advert':\r\n\t\t\t\tthis.renderAdvert();\r\n\t\t\t\tthis.filter = new Filter();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/logout':\r\n\t\t\t\t\tthis.storage.removeLoginedUserFromLocalStorage();\r\n\t\t\t\t\tlocation.assign('/');\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/history':\r\n\t\t\t\t\tif (this.storage.getLoginedUserFromTempStorage()){\r\n\t\t\t\t\t\tthis.renderHistory(this.storage.getBoughtItemsByUser());\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\tlocation.assign('/sign');\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/sell':\r\n\t\t\t\t\tif (this.storage.getLoginedUserFromTempStorage()){\r\n\t\t\t\t\t\tawait this.renderSell();\r\n\t\t\t\t\t\tthis.sell = new Sell(this.storage.getLoginedUserFromTempStorage());\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\tlocation.assign('/sign');\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase '/':\r\n\t\t\t\tawait this.renderMainPage();\r\n\t\t\t\t// this.renderResult(this.storage.getTempStorage('items'));\r\n\t\t\t\tthis.renderResult(this.storage.getItemsByAvailable())\r\n\t\t\t\tthis.filter = new Filter({option: 'all'})\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault: console.log('page not found');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\ndocument.addEventListener(\"DOMContentLoaded\", function(){\r\n\t_.templateSettings = {\r\n\t\tevaluate    : /\\{\\{([\\s\\S]+?)\\}\\}/g,\r\n\t\tinterpolate : /\\{\\{=([\\s\\S]+?)\\}\\}/g,\r\n\t\tescape      : /\\{\\{-([\\s\\S]+?)\\}\\}/g\r\n\t};\r\n\tlet manager = new Manager();\r\n});\r\nclass Signin{\r\n\tconstructor(users){\r\n\t\tthis.storage = new Storage();\r\n\t\tthis.users = users;\r\n\t\tthis.emailRegExp = /^([a-z0-9_-]+\\.)*[a-z0-9_-]+@[a-z0-9_-]+(\\.[a-z0-9_-]+)*\\.[a-z]{2,6}$/i;\r\n\t\tthis.passRegExp = /^\\w{6,}$/;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tasync init(){\r\n\t\tawait this.storage.init();\r\n\t\tthis.findNodes();\r\n\t\tthis.bindAll();\r\n\t\tthis.addEvents();\r\n\r\n\t}\r\n\r\n\tfindNodes(){\r\n\t\tthis.nodes = {\r\n\t\t\tform: document.forms.signin,\r\n\t\t\temail: document.forms.signin.elements.email,\r\n\t\t\tpass: document.forms.signin.elements.pass,\r\n\t\t\tsubmit: document.forms.signin.elements.submit,\r\n\t\t\twarning: document.getElementsByClassName('signin__warning')[0]\r\n\t\t}\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tthis.nodes.submit.addEventListener('click', this.submitForm)\r\n\t}\r\n\r\n\tbindAll() {\r\n\t\tthis.submitForm = this.submitForm.bind(this);\r\n\t}\r\n\r\n\tsubmitForm(e){\r\n\t\te.preventDefault();\r\n\t\tlet flag = true;\r\n\t\tthis.nodes.warning.innerHTML = '';\r\n\t\t//check valid email\r\n\t\tif (!this.emailRegExp.test(this.nodes.email.value)) {\r\n\t\t\tthis.createWarningMessage('email');\r\n\t\t\tflag = false;\r\n\t\t} //check valid passward\r\n\t\tif (!this.passRegExp.test(this.nodes.pass.value)) {\r\n\t\t\tthis.createWarningMessage('password');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif (flag){\r\n\t\t\tthis.findUser(this.nodes.email.value, this.nodes.pass.value)\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tfindUser(login, pass){\r\n\t\tlet user = this.users.find(user => user.login === login && user.password === pass );\r\n\t\tif (!user) {\r\n\t\t\tthis.createWarningMessage('unknownuser');\r\n\t\t} else {\r\n\t\t\tthis.successLogin(user);\r\n\t\t\t//console.dir(this.storage.getLoginedUserFromLocalStorage());\r\n\t\t\tlocation.assign('/');\r\n\t\t}\r\n\t}\r\n\r\n\t// add user logined user to LocalStorage\r\n\tsuccessLogin(user) {\r\n\t\tthis.storage.addLoginedUsertoLocalStorage(user);\r\n\t}\r\n\r\n\tcreateWarningMessage(errorname){\r\n\t\tlet message = document.createElement('p');\r\n\t\tswitch (errorname){\r\n\t\t\tcase 'email':\r\n\t\t\t\tmessage.append(document.createTextNode('You entered incorrect email'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'password':\r\n\t\t\t\tmessage.append(document.createTextNode('You entered incorrect pass: 6 lettes or numers or _'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'unknownuser':\r\n\t\t\t\tmessage.append(document.createTextNode('Unknown user'));\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('incorrect error name');\r\n\t\t}\r\n\t\tthis.nodes.warning.appendChild(message);\r\n\t}\r\n }\r\nclass Registration{\r\n\tconstructor(users){\r\n\t\tthis.storage = new Storage();\r\n\t\tthis.users = users;\r\n\t\tthis.emailRegExp = /^([a-z0-9_-]+\\.)*[a-z0-9_-]+@[a-z0-9_-]+(\\.[a-z0-9_-]+)*\\.[a-z]{2,6}$/i;\r\n\t\tthis.passRegExp = /^\\w{6,}$/;\r\n\t\tthis.nameRegExp= /^[a-zа-яё]{3,}$/i;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tasync init(){\r\n\t\tawait this.storage.init();\r\n\t\tthis.findNodes();\r\n\t\tthis.bindAll();\r\n\t\tthis.addEvents();\r\n\r\n\t}\r\n\r\n\tfindNodes(){\r\n\t\tthis.nodes = {\r\n\t\t\tform: document.forms.registration,\r\n\t\t\temail: document.forms.registration.elements.email,\r\n\t\t\tname: document.forms.registration.elements.name,\r\n\t\t\tpass0: document.forms.registration.elements.pass[0],\r\n\t\t\tpass1: document.forms.registration.elements.pass[1],\r\n\t\t\tsubmit: document.forms.registration.elements.submit,\r\n\t\t\twarning: document.getElementsByClassName('registration__warning')[0]\r\n\t\t}\r\n\t\tconsole.dir(this.nodes);\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tthis.nodes.submit.addEventListener('click', this.submitForm)\r\n\t}\r\n\r\n\tbindAll() {\r\n\t\tthis.submitForm = this.submitForm.bind(this);\r\n\t}\r\n\r\n\tsubmitForm(e){\r\n\t\te.preventDefault();\r\n\t\tlet flag = true;\r\n\t\tthis.nodes.warning.innerHTML = '';\r\n\t\t//check valid email\r\n\t\tif (!this.emailRegExp.test(this.nodes.email.value)) {\r\n\t\t\tthis.createWarningMessage('email');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\t//check valid passward\r\n\t\tif (!this.passRegExp.test(this.nodes.pass0.value) || !this.passRegExp.test(this.nodes.pass1.value)) {\r\n\t\t\tthis.createWarningMessage('password');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\t//chek valid name\r\n\t\tif (!this.nameRegExp.test(this.nodes.name.value)) {\r\n\t\t\tthis.createWarningMessage('name');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif (!flag){\r\n\t\t\treturn;\r\n\t\t} else if (this.findUser(this.nodes.email.value)) {\r\n\t\t\tthis.addNewUserToLocalStorage(this.createUser());\r\n\t\t\tthis.createWarningMessage('ok');\r\n\t\t} else {\r\n\t\t\tthis.createWarningMessage('exist');\r\n\t\t}\r\n\t}\r\n\r\n\tcreateUser(){\r\n\t\tlet\tnewUser = {\r\n\t\t\tlogin: this.nodes.email.value,\r\n\t\t\tname: this.nodes.name.value,\r\n\t\t\tpassword: this.nodes.pass0.value,\r\n\t\t\tbuyitems: [],\r\n\t\t\tsellitems: []\r\n\t\t}\r\n\t\treturn newUser;\r\n\t}\r\n\r\n\taddNewUserToLocalStorage(user){\r\n\t\tthis.storage.addNewUsertoTempStorage(user)\r\n\t}\r\n\r\n\tfindUser(login){\r\n\t\tlet user = this.users.find(user => user.login === login);\r\n\t\tif (user) {\r\n\t\t\t//this user is exist\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\t// this user doesn't exist - go on registration\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tcreateWarningMessage(errorname){\r\n\t\tlet message = document.createElement('p');\r\n\t\tswitch (errorname){\r\n\t\t\tcase 'email':\r\n\t\t\t\tmessage.append(document.createTextNode('You entered incorrect email'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'password':\r\n\t\t\t\tmessage.append(document.createTextNode('You entered incorrect pass: 6 lettes or numers or _ or they are not equal each other'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'name':\r\n\t\t\t\tmessage.append(document.createTextNode('You enterd incorrect name: only letters and min size=3'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'exist':\r\n\t\t\t\tmessage.append(document.createTextNode('This user have been existed'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'ok':\r\n\t\t\t\tmessage.append(document.createTextNode(`You've been just registered. Sign in!`));\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('incorrect error name');\r\n\t\t}\r\n\t\tthis.nodes.warning.appendChild(message);\r\n\t}\r\n }\r\nclass Item {\r\n\tconstructor(item) {\r\n\t\tthis.storage = new Storage();\r\n\t\tthis.nodes = {};\r\n\t\tthis.bidRegExp = /\\d+/i;\r\n\t\tthis.item = item;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tasync init(){\r\n\t\tawait this.storage.init();\r\n\t\tthis.getTypeItem();\r\n\t\tthis.findNodes();\r\n\t\tthis.bindAll();\r\n\t\tthis.addEvents();\r\n\t\tthis.checkReserved()\r\n\t}\r\n\r\n\tfindNodes() {\r\n\t\tif (this.type == 'auction'){\r\n\t\t\tthis.nodes = {\r\n\t\t\t\tbid: document.getElementsByClassName('item-page__start-bid-input')[0],\r\n\t\t\t\tbids: document.getElementsByClassName('item-page_bids-value')[0],\r\n\t\t\t\tprice: document.getElementsByClassName('item-page__start-bid-price')[0],\r\n\t\t\t\tbuyBtn: document.getElementsByClassName('item-page__btn-bid')[0],\r\n\t\t\t\tstartbid: document.getElementsByClassName('item-page__start-bid-price')[0],\r\n\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.nodes = {\r\n\t\t\t\tbuyBtn: document.getElementsByClassName('item-page-buy')[0]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbindAll(){\r\n\t\tthis.handler = this.handler.bind(this);\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tthis.nodes.buyBtn.addEventListener('click', this.handler);\r\n\t}\r\n\r\n\tgetTypeItem(){\r\n\t\tif (this.item.auction){\r\n\t\t\tthis.type = 'auction';\r\n\t\t} else {\r\n\t\t\tthis.type = 'buyitnow';\r\n\t\t}\r\n\t}\r\n\r\n\thandler(e){\r\n\tlet user  = this.storage.getLoginedUserFromTempStorage();\r\n\t\tif(user){\r\n\t\t\tif (this.type == 'buyitnow'){\r\n\t\t\t\t//save id of item to user\r\n\t\t\t\tfor (let i =0; i < this.storage.tempUsers.length; i++){\r\n\t\t\t\t\tif (this.storage.tempUsers[i].login == user.login){\r\n\t\t\t\t\t\tthis.storage.tempUsers[i].buyitems.push({\"item\": this.item.id_item});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// reserve item\r\n\t\t\t\tfor (let i = 0; i < this.storage.tempItems.length; i++){\r\n\t\t\t\t\tif (this.storage.tempItems[i].id_item == this.item.id_item){\r\n\t\t\t\t\t\tthis.storage.tempItems[i].reserved = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.storage.updateAllLocalStorage();\r\n\t\t\t\tlocation.assign(`/item${this.item.id_item}`);\r\n\t\t\t} else {\r\n\t\t\t\tif ( this.checkBid()) {\r\n\t\t\t\t\tfor (let i =0; i < this.storage.tempUsers.length; i++){\r\n\t\t\t\t\t\tif (this.storage.tempUsers[i].login == user.login){\r\n\t\t\t\t\t\t\tthis.storage.tempUsers[i].buyitems.push({\r\n\t\t\t\t\t\t\t\t\"item\": this.item.id_item,\r\n\t\t\t\t\t\t\t\t\"mybid\": parseInt(this.nodes.bid.value) + '.00'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let i = 0; i < this.storage.tempItems.length; i++){\r\n\t\t\t\t\t\tif (this.storage.tempItems[i].id_item == this.item.id_item){\r\n\t\t\t\t\t\t\tthis.storage.tempItems[i].price = parseInt(this.nodes.bid.value) + '.00';\r\n\t\t\t\t\t\t\tthis.storage.tempItems[i].bids = +this.storage.tempItems[i].bids + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.dir(\tthis.storage.tempUsers);\r\n\t\t\t\t\tconsole.dir(\tthis.storage.tempItems);\r\n\t\t\t\t\tthis.storage.updateAllLocalStorage();\r\n\t\t\t\t\tthis.changeTextBtn();\r\n\t\t\t\t\tthis.changeInfoAboutItem();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlocation.assign('/sign');\r\n\t\t}\r\n\t}\r\n\r\n\tcheckBid(){\r\n\t\tif (this.bidRegExp.test(this.nodes.bid.value) && this.nodes.bid.value > this.item.price) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\talert('You entered incorrect bid');\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}\r\n\tchangeTextBtn(){\r\n\t\tthis.nodes.buyBtn.value = \"Bought!\";\r\n\t\tthis.nodes.buyBtn.disabled = true;\r\n\t}\r\n\r\n\tchangeInfoAboutItem() {\r\n\t\tthis.nodes.price.innerHTML = this.nodes.bid.value + '.00' ;\r\n\t\tthis.nodes.bids.innerHTML = +this.item.bids + 1;\r\n\t}\r\n\r\n\tcheckReserved() {\r\n\t\tif (this.item.reserved == true) {\r\n\t\t\tthis.changeTextBtn();\r\n\t\t}\r\n\t}\r\n\r\n}\r\nclass Sell{\r\n\tconstructor(){\r\n\t\tthis.textRegExp = /^\\w{3,}$/i;\r\n\t\tthis.priceRegExp = /^[1-9][0-9]*$/i;\r\n\t\tthis.storage = new Storage();\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tasync init(){\r\n\t\tawait this.storage.init();\r\n\t\tthis.findNodes();\r\n\t\tthis.bindAll();\r\n\t\tthis.addEvents();\r\n\t}\r\n\r\n\tfindNodes(){\r\n\t\tthis.nodes = {\r\n\t\t\tform: document.getElementsByName('sell')[0],\r\n\t\t\ttitle: document.getElementsByName('title')[0],\r\n\t\t\tsubtitle: document.getElementsByName('subtitle')[0],\r\n\t\t\tcondition: document.getElementsByName('condition')[0],\r\n\t\t\tprevimg: document.getElementsByName('previmg')[0],\r\n\t\t\tprice: document.getElementsByName('price')[0],\r\n\t\t\tformat: document.getElementsByName('format')[0],\r\n\t\t\tdateExp: document.getElementsByName('dateExp')[0],\r\n\t\t\tcountry: document.getElementsByName('country')[0],\r\n\t\t\tshipping: document.getElementsByName('shipping')[0],\r\n\t\t\tpictures: document.getElementsByName('pictures')[0],\r\n\t\t\tsubmit: document.getElementsByName('submit')[0],\r\n\t\t\twarning: document.getElementsByClassName('sell__warning')[0]\r\n\t\t}\r\n\t}\r\n\r\n\tbindAll(){\r\n\t\tthis.handler = this.handler.bind(this);\r\n\t}\r\n\r\n\taddEvents(){\r\n\t\tthis.nodes.submit.addEventListener('click', this.handler);\r\n\t}\r\n\r\n\thandler(e){\r\n\t\te.preventDefault();\r\n\t\tthis.clearWarning();\r\n\t\tif(this.checkForm()){\r\n\t\t\tthis.createNewItem();\r\n\t\t\tthis.addNewItemToSellList()\r\n\t\t\tthis.changeTextBtn();\r\n\t\t}\r\n\t}\r\n\r\n\tclearWarning(){\r\n\t\tthis.nodes.warning.innerHTML = '';\r\n\t}\r\n\r\n\taddNewItemToSellList(){\r\n\t\tlet user  = this.storage.getLoginedUserFromTempStorage();\r\n\t\tif(user){\r\n\t\t\t//save id of item to user\r\n\t\t\tfor (let i =0; i < this.storage.tempUsers.length; i++){\r\n\t\t\t\tif (this.storage.tempUsers[i].login == user.login){\r\n\t\t\t\t\tthis.storage.tempUsers[i].sellitems.push({\"item\": this.newItem.id_item});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// reserve item\r\n\t\t\tthis.storage.updateAllLocalStorage();\r\n\t\t}\r\n\t}\r\n\r\n\tcreateNewItem(){\r\n\t\tthis.newItem = {\r\n\t\t\tid_item: this.storage.generateNewId(),\r\n\t\t\ttitle: this.nodes.title.value,\r\n\t\t\tsubtitle: this.nodes.subtitle.value,\r\n\t\t\tcondition: this.getCondition(),\r\n\t\t\tprevimg_path: 'img/' + this.nodes.previmg.files[0].name,\r\n\t\t\tprice: this.nodes.price.value,\r\n\t\t\tbids: \"0\",\r\n\t\t\tauction: this.isAuction(),\r\n\t\t\tbuy: this.isBuy(),\r\n\t\t\treserved: false,\r\n\t\t\tcountry: this.nodes.country.value,\r\n\t\t\tdate_exp: this.nodes.dateExp.value,\r\n\t\t\tshipping: this.getShipping(),\r\n\t\t\tpictures: [\r\n\t\t\t\t{link: 'img/' + this.nodes.pictures.files[0].name},{link: 'img/' + this.nodes.pictures.files[1].name},{link: 'img/' + this.nodes.pictures.files[2].name}\r\n\t\t\t]\r\n\t\t}\r\n\t\tconsole.dir(this.newItem );\r\n\t\tthis.storage.addNewItemToTempStorage(this.newItem);\r\n\t}\r\n\r\n\tgetShipping(){\r\n\t\tlet indexSelected = this.nodes.shipping.selectedIndex;\r\n\t\treturn this.nodes.shipping.getElementsByTagName('option')[indexSelected].value;\r\n\t}\r\n\r\n\tgetCondition() {\r\n\t\tlet indexSelected = this.nodes.condition.selectedIndex;\r\n\t\treturn this.nodes.condition.getElementsByTagName('option')[indexSelected].value;\r\n\t}\r\n\r\n\tisBuy() {\r\n\t\tlet indexSelected = this.nodes.format.selectedIndex;\r\n\t\tif (indexSelected == 0) { return true;}\r\n\t\tif (indexSelected == 1) { return false;}\r\n\t}\r\n\r\n\tisAuction(){\r\n\t\tlet indexSelected = this.nodes.format.selectedIndex;\r\n\t\tif (indexSelected == 0) { return false;}\r\n\t\tif (indexSelected == 1) { return true;}\r\n\t}\r\n\r\n\tcheckForm(){\r\n\t\tlet flag = true;\r\n\t\tif (!this.textRegExp.test(this.nodes.title.value)){\r\n\t\t\tthis.createWarningMessage('title');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif (!this.textRegExp.test(this.nodes.subtitle.value)){\r\n\t\t\tthis.createWarningMessage('subtitle');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif (this.nodes.previmg.files.length == 0){\r\n\t\t\tthis.createWarningMessage('previmg');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif (!this.priceRegExp.test(this.nodes.price.value)){\r\n\t\t\tthis.createWarningMessage('price');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif(new Date(this.nodes.dateExp.value) <= Date.now()){\r\n\t\t\tthis.createWarningMessage('dateExp');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif(!this.textRegExp.test(this.nodes.country.value)){\r\n\t\t\tthis.createWarningMessage('country');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\tif(this.nodes.pictures.files.length !=3){\r\n\t\t\tthis.createWarningMessage('pictures');\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n\r\n\tcreateWarningMessage(errorname){\r\n\t\tlet message = document.createElement('p');\r\n\t\tswitch (errorname){\r\n\t\t\tcase 'title':\r\n\t\t\tmessage.append(document.createTextNode('you enterd invalid title or skip'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'subtitle':\r\n\t\t\tmessage.append(document.createTextNode('you enterd invalid subtitle or skip'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'previmg':\r\n\t\t\tmessage.append(document.createTextNode('you skip downloading main img'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'price':\r\n\t\t\tmessage.append(document.createTextNode('You entered invalid price or skip'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'dateExp':\r\n\t\t\tmessage.append(document.createTextNode('You entered invalid date or skip'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'country':\r\n\t\t\tmessage.append(document.createTextNode('You skip country'));\r\n\t\t\tbreak;\r\n\t\t\tcase 'pictures':\r\n\t\t\tmessage.append(document.createTextNode('You skip downloding of 3 pictures'));\r\n\t\t\tbreak;\r\n\t\t\tdefault: console.log('incorrect error name');\r\n\t\t}\r\n\t\tthis.nodes.warning.appendChild(message);\r\n\t}\r\n\tchangeTextBtn(){\r\n\t\tthis.nodes.submit.value = \"ok!\";\r\n\t\tthis.nodes.submit.disabled = true;\r\n\t}\r\n}\r\n// Constructor\r\nfunction Slider (elem, config) {\r\n\tthis.elem = elem;\r\n\r\n\t//Read configuration\r\n\tthis.direction = config.direction || 'forward'; // лево - назад, вправао - вперед\r\n\tthis.autoDuration = config.autoDuration || 3000;\r\n\tthis.init();\r\n}\r\n\r\nSlider.prototype = {\r\nconstructor: Slider, /*Сохраним конструктор  чтобы Slider2 можно было сделать через Slider1:\r\nvar Slider2 = new Slider1.Constructor(document.getElementsByClassName('slider')[1], config)*/\r\n\r\n\tinit: function() {\r\n\t\t\tthis.screen = this.elem.querySelector('.slider__screen');\r\n\t\t\tthis.lens = this.elem.querySelector('.slider__lens');\r\n\t\t\tthis.slides = this.elem.querySelectorAll('.slider__item');\r\n\r\n\t\t\tthis.addCloneSlides();\r\n\t\t\tthis.prepareDomSlider();\r\n\t\t\tthis.bindAll();\r\n\t\t\tthis.addEvents();\r\n\t},\r\n\r\n\taddCloneSlides: function() {\r\n\t\t\tvar firstSlideClone = this.slides[0].cloneNode(true);\r\n\t\t\tvar lastSlideClone = this.slides[this.slides.length - 1].cloneNode(true);\r\n\t\t\tthis.lens.appendChild(firstSlideClone);\r\n\t\t\tthis.lens.insertBefore(lastSlideClone, this.slides[0]);\r\n\r\n\t},\r\n\r\n\tprepareDomSlider: function() {\r\n\t\t\tthis._slideWidth = this.slides[0].offsetWidth;\r\n\t\t\tthis._lensWidth = (this.slides.length + 2)*this.slides[0].offsetWidth + \"px\";\r\n\t\t\tthis.lens.style.width = this._lensWidth;\r\n\r\n\t\t\tthis._lensMarginLeft = -1*this.slides[0].offsetWidth + \"px\";\r\n\t\t\tthis.lens.style.marginLeft = this._lensMarginLeft;\r\n\r\n\t\t\tthis._currentLensMarginLeft = this._lensMarginLeft;\r\n\r\n\t\t\tthis.startCarousel();\r\n\r\n\t},\r\n\r\n\tbindAll: function() {\r\n\t\t\tthis.mousemoveHandler = this.mousemoveHandler.bind(this);\r\n\t\t\tthis.mouseupHandler = this.mouseupHandler.bind(this);\r\n\t\t\tthis.mouseleaveHandler = this.mouseleaveHandler.bind(this);\r\n\r\n\t},\r\n\r\n\r\n\tstartCarousel: function() {\r\n\t\t\tthis.lens.classList.add('slider__lens_transition');\r\n\t\t\tthis.timerAutoStart = setInterval(this.moveCarousel.bind(this), this.autoDuration, null, this.direction);\r\n\t},\r\n\r\n\r\n\r\n\tmoveCarousel: function(event, typeMove) {\r\n\t\t\tvar direction;\r\n\t\t\tswitch (typeMove) {\r\n\t\t\t\t\tcase 'forward':\r\n\t\t\t\t\t\t\tthis._currentLensMarginLeft = parseInt(this._lensMarginLeft) - this._slideWidth  + \"px\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'backward':\r\n\t\t\t\t\t\t\tthis._currentLensMarginLeft = parseInt(this._lensMarginLeft) + this._slideWidth + \"px\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'usermove':\r\n\t\t\t\t\tconsole.log('USERMOVE');\r\n\t\t\t\t\t\t\tdirection = event.clientX - this._startDragX;\r\n\t\t\t\t\t\t\tif (direction > 0) {\r\n\t\t\t\t\t\t\t\t\tthis._currentLensMarginLeft = parseInt(this._lensMarginLeft) + this._slideWidth + \"px\";\r\n\t\t\t\t\t\t\t} else if (direction < 0) {\r\n\t\t\t\t\t\t\t\t\tthis._currentLensMarginLeft = parseInt(this._lensMarginLeft) - this._slideWidth + \"px\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.lens.style.marginLeft = this._currentLensMarginLeft;\r\n\t\t\tthis._lensMarginLeft = this._currentLensMarginLeft;\r\n\r\n\t},\r\n\r\n\tcheckSlideCarousel: function() {\r\n\t\t\tif (parseInt(this._lensMarginLeft) == 0) {\r\n\t\t\t\t\tthis.cancelTransition();\r\n\t\t\t\t\tthis._lensMarginLeft = (2*this._slideWidth - parseInt(this._lensWidth)) + \"px\";\r\n\t\t\t\t\tthis.lens.style.marginLeft = this._lensMarginLeft;\r\n\t\t\t\t\tthis.turnOnTransition();\r\n\r\n\t\t\t}  else if (parseInt(this._lensMarginLeft) == (this._slideWidth - parseInt(this._lensWidth))) {\r\n\t\t\t\t\tthis.cancelTransition();\r\n\t\t\t\t\tthis._lensMarginLeft = -1*this._slideWidth + \"px\";\r\n\t\t\t\t\tthis.lens.style.marginLeft = this._lensMarginLeft;\r\n\t\t\t\t\tthis.turnOnTransition();\r\n\t\t\t}\r\n\t},\r\n\r\n\r\n\tcancelTransition: function() {\r\n\t\t\tthis.lens.classList.remove('slider__lens_transition');\r\n\t},\r\n\r\n\tturnOnTransition: function() {\r\n\t\t\tvar timerAddTransition = setTimeout(function(){this.lens.classList.add('slider__lens_transition');}.bind(this), 50);\r\n\t},\r\n\r\n\r\n\tfixWhich: function(e) {\r\n\t\t\tif (!e.which && e.button) { // если which нет, но есть button... (IE8-)\r\n\t\t\t\t\tif (e.button & 1) e.which = 1; // левая кнопка\r\n\t\t\t\t\telse if (e.button & 4) e.which = 2; // средняя кнопка\r\n\t\t\t\t\telse if (e.button & 2) e.which = 3; // правая кнопка\r\n\t\t\t}\r\n\t},\r\n\r\n\tmousedownHandler: function(event) {\r\n\t\t\tvar event = event || window.event; //console.log('onmousedown');\r\n\t\t\tthis.fixWhich(event);\r\n\t\t\t\t\tif (event.which != 1) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tclearInterval(this.timerAutoStart);\r\n\t\t\tthis._startDragX = event.clientX; //положение мыши при mousedown\r\n\t\t\tthis._startX = this._startDragX;  //положение мыши перед onmousemove в конце каждого onmousemove\r\n\t\t\tthis._currentLensMarginLeft = this._lensMarginLeft;\r\n\r\n\t\t\t//this.lens.onmousemove = this.mousemoveHandler.bind(this);\r\n\t\t\t//this.lens.onmouseup = this.mouseupHandler.bind(this);\r\n\t\t\t//this.screen.onmouseleave = this.mouseleaveHandler.bind(this);\r\n\t\t\tthis.lens.addEventListener('mousemove', this.mousemoveHandler, false);\r\n\t\t\tthis.lens.addEventListener('mouseup', this.mouseupHandler, false);\r\n\t\t\tthis.screen.addEventListener('mouseleave', this.mouseleaveHandler, false);\r\n\t},\r\n\r\n\tmousemoveHandler: function(event) {\r\n\t\t\tvar event = event || window.event;\r\n\t\t\t//console.log('onmousemove');\r\n\t\t\tthis._currentLensMarginLeft = parseInt(this._currentLensMarginLeft) + event.clientX - this._startX  + \"px\";\r\n\t\t\tthis._startX = event.clientX;\r\n\t\t\tthis.lens.style.marginLeft = this._currentLensMarginLeft;\r\n\t},\r\n\r\n\tmouseupHandler: function(event) {\r\n\t\t\tvar event = event || window.event;\r\n\t\t\t//console.log('mouseup');\r\n\t\t\tthis.moveCarousel(event, 'usermove');\r\n\t\t\tthis.deleteEvents();\r\n\t\t\t//this.lens.onmousemove = this.lens.onmouseup = this.screen.onmouseleave = null;\r\n\t},\r\n\r\n\tmouseleaveHandler: function (event) {\r\n\t\t\tvar event = event || window.event;\r\n\t\t\t//console.log('mouseleave');\r\n\t\t\tthis.moveCarousel(event, 'usermove');\r\n\t\t\tthis.deleteEvents();\r\n\t\t\t//this.lens.onmousemove = this.lens.onmouseup = this.screen.onmouseleave = null;\r\n\t},\r\n\r\n\tondragstart: function() {\r\n\t\t\treturn false;\r\n\t},\r\n\r\n\taddEvents: function () {\r\n\t\t\tthis.elem.ondragstart = function() {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t\tthis.lens.addEventListener('transitionend', this.checkSlideCarousel.bind(this), false);\r\n\t\t\tthis.screen.addEventListener('mousedown', this.mousedownHandler.bind(this), false);\r\n\t},\r\n\r\n\tdeleteEvents: function() {\r\n\t\t\tthis.lens.removeEventListener('mousemove', this.mousemoveHandler, false);\r\n\t\t\tthis.lens.removeEventListener('mouseup', this.mouseupHandler, false);\r\n\t\t\tthis.screen.removeEventListener('mouseleave', this.mouseleaveHandler, false);\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction launchSliders () {\r\n\r\n\tconfig = {\r\n\t\t\tautoDuration: 2000\r\n\t}\r\n\tvar slider1 = new Slider(document.getElementsByClassName('slider')[0], config);\r\n}\r\n\r\nwindow.onload = launchSliders;"],"file":"main.js"}